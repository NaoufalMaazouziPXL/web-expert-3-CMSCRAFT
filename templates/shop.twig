{% include '_snippets/_header.twig' %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta charset="UTF-8">
    <title>MANGAZINE - Shop</title>
    <link rel="stylesheet" href="../css/main.css">
</head>
<body>
<header class="header-content">
    <div class="top-mangas-wrapper">
        <div class="header-title">
            <h4>Shop</h4>
            <hr>
        </div>
    </div>
    <div class="filter-container">
        {% set genres = craft.entries.section('genres').all() %}
        {% set ages = craft.entries.section('ages').all() %}
        <form method="get">
            <label for="genreFilter">Genre:</label>
            <select id="genreFilter" name="genreFilter" onchange="this.form.submit()">
                <option value="">All Genres</option>
                {% for genre in genres %}
                    <option value="{{ genre.id }}"
                            {% if selectedGenreId is defined and selectedGenreId == genre.id %}
                    selected
                            {% endif %}>{{ genre.title }}
                    </option>
                {% endfor %}
            </select>
            <label for="ageFilter">Age:</label>
            <select id="ageFilter" name="ageFilter" onchange="this.form.submit()">
                <option value="">All Ages</option>
                {% for age in ages %}
                    <option value="{{ age.id }}"
                            {% if selectedAgeId is defined and selectedAgeId == age.id %}
                    selected
                            {% endif %}>{{ age.title }}
                    </option>
                {% endfor %}
            </select>
        </form>
    </div>

    <div class="mangas-shop-container">
        <div class="mangas-first-row-container">
            <div class="mangas-container">
                {% set productsQuery = craft.entries.section('shop') %}
                {% if selectedGenreId is defined %}
                    {% set productsQuery = productsQuery.relatedTo({
                        targetElement: selectedGenreId,
                        field: 'genreFieldHandle'
                    }) %}
                {% endif %}
                {% if selectedAgeId is defined %}
                    {% set productsQuery = productsQuery.relatedTo({
                        targetElement: selectedAgeId,
                        field: 'ageFieldHandle'
                    }) %}
                {% endif %}
                {% set products = productsQuery.all() %}
                {% for product in products %}
                    <div class="manga-content-holder">
                        <div class="manga-information-container">
                            <div class="first-title-wrapper">
                                {% set image = product.mangaImage.one() %}
                                {% if image %}
                                    <a href="https://werkpakket3-webexpert.ddev.site/product/{{ product.title }}">
                                        <img src="{{ image.url }}" alt="{{ product.mangaTitle }}">
                                    </a>
                                {% else %}
                                    <img src="../images/default.png" alt="Default Image">
                                {% endif %}
                                <div class="manga-title-price">
                                    <h3>{{ product.mangaTitle }}</h3>
                                    <h3>{{ product.priceTag }}</h3>
                                </div>
                            </div>
                            <div class="manga-description">
                                <h6>{{ product.mangaDescription }}</h6>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
        </div>

        <div class="pagination">
            <div>
                <p>Previous</p>
            </div>
            <div>
                <p class="pagination__item">1</p>
            </div>
            <div>
                <p>Next</p>
            </div>
        </div>
    </div>
</header>
{% include '_snippets/_footer.twig' %}
</body>
</html>
